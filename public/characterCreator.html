<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <style>

    </style>

    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <form id="characterCreator">
        <label>Name</label>
        <input type="text" id="name" name="name" class=""><br><br>
        <label>Nickname</label>
        <input type="text" id="nickname" name="nickname" class=""><br><br>
        <label>Level</label>
        <input type="number" id="lvl" name="lvl" value="1" class=""><br><br>
        <label>Stat Points</label>
        <input type="number" id="statpoints" name="statpoints" value="0" class=""><br><br>
        <label>Experience</label>
        <input type="number" id="xp" name="xp" value="0" class="xp"><br><br>
        <label>IQ</label>
        <input type="number" id="iq" name="iq" value="0" class="stats mental"><br><br>
        <label>Mental Endurance</label>
        <input type="number" id="mEndurance" name="mEndurance" value="0" class="stats mental"><br><br>
        <label>Mental Affinity</label>
        <input type="number" id="mAffinity" name="mAffinity" value="0" class="stats mental"><br><br>
        <label>Physical Strength</label>
        <input type="number" id="pStrength" name="pStrength" value="0" class="stats physical"><br><br>
        <label>Physical Prowess</label>
        <input type="number" id="pProwess" name="pProwess" value="0" class="stats physical"><br><br>
        <label>Physical Endurance</label>
        <input type="number" id="pEndurance" name="pEndurance" value="0" class="stats physical"><br><br>
        <label>Speed</label>
        <input type="number" id="speed" name="speed" value="0" class="stats speed"><br><br>
        <label>Wealth</label>
        <input type="number" id="wealth" name="wealth" value="2" class="wealth"><br><br>
        <label>Power Name</label>
        <input type="text" id="powername" name="powername" class="power"><br><br>
        <label>Power Description</label>
        <input type="text" id="powerdescription" name="powerdescription" class="power"><br><br>
        <input type="submit" value="Create">
    </form>
    <button onclick="preview()">Preview</button>
    <script type="text/javascript">
        function preview() {
            const elements = document.getElementsByClassName("stats");
            document.getElementById('deficitpoints').innerHTML = calculateDeficit(elements)


        }
        /** Returns the cost of statpoints for the set level of the stat. Returns a negative number to indicate a gain of statpoints
         * @param {number} setstat The level the stat is set to
         * @return {number} result This is the resulting cost of statpoints for the set stat, negative if its a gain of statpoints
         */
        function generateStatCost(setStatLevel) {
            setStatLevel = parseInt(setStatLevel);
            if (setStatLevel < 0) { //Checks if setstatlevel is negative if so returns the negative setstatlevel as a statpoint gain
                return setStatLevel
            } else {
                for (loopIterator = 0, result = 0; loopIterator <= setStatLevel; loopIterator++) { // iterates to find the statpoint cost needed to get a stat to the setstat level
                    result = result + loopIterator;
                }
                return result; // returns statpoint cost in the case of it being a non negative.
            }
        }
        /** Returns the net cost of set statlevels with current ammount of statpoitns, returns negative if their is a deficit and positive if there is a suprlus of statpoints
         *@param {htmlcollection} statCollection This is a collection of elements that contain number values within the class 'stats'
         *@return {number} workingValue This is a number that is the total statpoint cost being either negative or positive depending on if free statpoints remain.
         */
        function calculateDeficit(statCollection) {
            let workingValue = 0;
            for (statValue of statCollection) {
                if (isNaN(statValue.value)) {
                    return "Invalid entry";
                }
                workingValue += generateStatCost(statValue.value);
            }
            const setStatPoints = parseInt(document.getElementById('statpoints').value);
            workingValue = setStatPoints - workingValue;
            return workingValue;
        }

        document.getElementById('characterCreator').onsubmit = function(event) {
            event.preventDefault();
            const data = new FormData(event.target);
            const value = JSON.stringify(Object.fromEntries(data.entries()));

            //Turn this JSON object into a cookie
            setCookie("value", value, 365);
            //console.log(getCookie("value"));

            //and take us to the character sheet page to see our new character stats
        };


        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }


        //for testing cookies, not to be used
        /*
        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        */
    </script>
    <p style="font-size:25px">Remaining Stat Points</p>
    <p id="deficitpoints"></p>
    <script src="" async defer>
    </script>
</body>

</html>